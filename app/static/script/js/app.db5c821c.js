(function(){var e={6700:function(e,s,t){var o={"./af":3906,"./af.js":3906,"./ar":902,"./ar-dz":3853,"./ar-dz.js":3853,"./ar-kw":299,"./ar-kw.js":299,"./ar-ly":6825,"./ar-ly.js":6825,"./ar-ma":6379,"./ar-ma.js":6379,"./ar-ps":3639,"./ar-ps.js":3639,"./ar-sa":7700,"./ar-sa.js":7700,"./ar-tn":2059,"./ar-tn.js":2059,"./ar.js":902,"./az":6043,"./az.js":6043,"./be":7936,"./be.js":7936,"./bg":4078,"./bg.js":4078,"./bm":4014,"./bm.js":4014,"./bn":9554,"./bn-bd":7114,"./bn-bd.js":7114,"./bn.js":9554,"./bo":6529,"./bo.js":6529,"./br":5437,"./br.js":5437,"./bs":9647,"./bs.js":9647,"./ca":9951,"./ca.js":9951,"./cs":6113,"./cs.js":6113,"./cv":7965,"./cv.js":7965,"./cy":5858,"./cy.js":5858,"./da":3515,"./da.js":3515,"./de":2831,"./de-at":6263,"./de-at.js":6263,"./de-ch":1127,"./de-ch.js":1127,"./de.js":2831,"./dv":4510,"./dv.js":4510,"./el":8616,"./el.js":8616,"./en-au":4595,"./en-au.js":4595,"./en-ca":3545,"./en-ca.js":3545,"./en-gb":9609,"./en-gb.js":9609,"./en-ie":3727,"./en-ie.js":3727,"./en-il":3302,"./en-il.js":3302,"./en-in":6305,"./en-in.js":6305,"./en-nz":9128,"./en-nz.js":9128,"./en-sg":4569,"./en-sg.js":4569,"./eo":650,"./eo.js":650,"./es":6358,"./es-do":4214,"./es-do.js":4214,"./es-mx":8639,"./es-mx.js":8639,"./es-us":232,"./es-us.js":232,"./es.js":6358,"./et":7279,"./et.js":7279,"./eu":5515,"./eu.js":5515,"./fa":7981,"./fa.js":7981,"./fi":7090,"./fi.js":7090,"./fil":9208,"./fil.js":9208,"./fo":2799,"./fo.js":2799,"./fr":3463,"./fr-ca":2213,"./fr-ca.js":2213,"./fr-ch":2848,"./fr-ch.js":2848,"./fr.js":3463,"./fy":1468,"./fy.js":1468,"./ga":8163,"./ga.js":8163,"./gd":2898,"./gd.js":2898,"./gl":6312,"./gl.js":6312,"./gom-deva":682,"./gom-deva.js":682,"./gom-latn":9178,"./gom-latn.js":9178,"./gu":1400,"./gu.js":1400,"./he":2795,"./he.js":2795,"./hi":7009,"./hi.js":7009,"./hr":6506,"./hr.js":6506,"./hu":9565,"./hu.js":9565,"./hy-am":3864,"./hy-am.js":3864,"./id":5626,"./id.js":5626,"./is":6649,"./is.js":6649,"./it":151,"./it-ch":5348,"./it-ch.js":5348,"./it.js":151,"./ja":9830,"./ja.js":9830,"./jv":3751,"./jv.js":3751,"./ka":3365,"./ka.js":3365,"./kk":5980,"./kk.js":5980,"./km":9571,"./km.js":9571,"./kn":5880,"./kn.js":5880,"./ko":6809,"./ko.js":6809,"./ku":6773,"./ku-kmr":257,"./ku-kmr.js":257,"./ku.js":6773,"./ky":5505,"./ky.js":5505,"./lb":553,"./lb.js":553,"./lo":1237,"./lo.js":1237,"./lt":1563,"./lt.js":1563,"./lv":1057,"./lv.js":1057,"./me":6495,"./me.js":6495,"./mi":3096,"./mi.js":3096,"./mk":3874,"./mk.js":3874,"./ml":6055,"./ml.js":6055,"./mn":7747,"./mn.js":7747,"./mr":7113,"./mr.js":7113,"./ms":8687,"./ms-my":7948,"./ms-my.js":7948,"./ms.js":8687,"./mt":4532,"./mt.js":4532,"./my":4655,"./my.js":4655,"./nb":6961,"./nb.js":6961,"./ne":2512,"./ne.js":2512,"./nl":8448,"./nl-be":2936,"./nl-be.js":2936,"./nl.js":8448,"./nn":9031,"./nn.js":9031,"./oc-lnc":5174,"./oc-lnc.js":5174,"./pa-in":118,"./pa-in.js":118,"./pl":3448,"./pl.js":3448,"./pt":3518,"./pt-br":2447,"./pt-br.js":2447,"./pt.js":3518,"./ro":817,"./ro.js":817,"./ru":262,"./ru.js":262,"./sd":8990,"./sd.js":8990,"./se":3842,"./se.js":3842,"./si":7711,"./si.js":7711,"./sk":756,"./sk.js":756,"./sl":3772,"./sl.js":3772,"./sq":6187,"./sq.js":6187,"./sr":732,"./sr-cyrl":5713,"./sr-cyrl.js":5713,"./sr.js":732,"./ss":9455,"./ss.js":9455,"./sv":9770,"./sv.js":9770,"./sw":959,"./sw.js":959,"./ta":6459,"./ta.js":6459,"./te":5302,"./te.js":5302,"./tet":7975,"./tet.js":7975,"./tg":1294,"./tg.js":1294,"./th":2385,"./th.js":2385,"./tk":4613,"./tk.js":4613,"./tl-ph":8668,"./tl-ph.js":8668,"./tlh":8190,"./tlh.js":8190,"./tr":4506,"./tr.js":4506,"./tzl":3440,"./tzl.js":3440,"./tzm":9852,"./tzm-latn":2350,"./tzm-latn.js":2350,"./tzm.js":9852,"./ug-cn":730,"./ug-cn.js":730,"./uk":99,"./uk.js":99,"./ur":2100,"./ur.js":2100,"./uz":6002,"./uz-latn":6322,"./uz-latn.js":6322,"./uz.js":6002,"./vi":4207,"./vi.js":4207,"./x-pseudo":4674,"./x-pseudo.js":4674,"./yo":570,"./yo.js":570,"./zh-cn":3644,"./zh-cn.js":3644,"./zh-hk":2591,"./zh-hk.js":2591,"./zh-mo":9503,"./zh-mo.js":9503,"./zh-tw":8080,"./zh-tw.js":8080};function n(e){var s=a(e);return t(s)}function a(e){if(!t.o(o,e)){var s=new Error("Cannot find module '"+e+"'");throw s.code="MODULE_NOT_FOUND",s}return o[e]}n.keys=function(){return Object.keys(o)},n.resolve=a,e.exports=n,n.id=6700},7069:function(e,s,t){"use strict";var o=t(9242),n=t(1020),a=t(2483);t(560);const r="",i=(0,n.Q_)("authStore",{state:()=>({token:localStorage.getItem("token")?localStorage.getItem("token"):"",user:"",error:"",loader:!1}),actions:{async auth(e,s){this.loader=!0;const t=await fetch(r+e,{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",mode:"cors",body:JSON.stringify(s)});if(this.loader=!1,!t.ok){const e=await t.json();return void(this.error=e.error)}const o=await t.json();this.token=o.token,this.user=o.user,localStorage.setItem("token",this.token),await Gs.push("chat")},async getUser(){if(!this.token)return;const e=await fetch(r+"/user?token="+this.token,{headers:{"Content-Type":"application/json"},credentials:"include",mode:"cors"});e.ok&&(this.user=await e.json(),"login"===Gs.name&&await Gs.push("chat"))},getters:{isAuth(){return""!==this.user}}}});var l=t(3396),c=t(4870),u=t(7139),d=t(5708),m=t(7629);const h={class:"container login-form",style:{"max-width":"50%"}},p=(0,l._)("h2",{style:{"padding-bottom":"8px","text-align":"center"}},"Логин",-1),g={class:"mb-3"},v=(0,l._)("label",{for:"inputUsername",class:"form-label"},"Имя пользователя",-1),f=(0,l._)("div",{id:"usernameHelp",class:"form-text"},"Введите имя пользователя",-1),j={class:"mb-3"},w=(0,l._)("label",{for:"inputPassword",class:"form-label"},"Пароль",-1),_=(0,l._)("div",{class:"mb-3 form-check"},[(0,l._)("input",{type:"checkbox",class:"form-check-input",id:"checkRemberMe"}),(0,l._)("label",{class:"form-check-label",for:"checkRemberMe"},"Запомнить меня")],-1),b={class:"mb-3"},k={class:"text-danger"},y={class:"mb-3"},S={class:"text-success"},U={class:"mb-3 center"},x=["disabled"],z={key:0,class:"d-flex justify-content-center"},D=(0,l._)("div",{class:"spinner-border",role:"status"},[(0,l._)("span",{class:"visually-hidden"},"Loading...")],-1),R=[D];var O={__name:"LoginComponent",setup(e){const s=i(),{meta:t,errors:n,defineField:a}=(0,d.cI)({validationSchema:m.Ry({username:m.Z_().required(),password:m.Z_().required().min(6).max(12)})}),[r,D]=a("username"),[O,C]=a("password"),M=(0,c.qj)({username:r,password:O,color:"#00000"});return(e,a)=>{const i=(0,l.up)("router-link");return(0,l.wg)(),(0,l.iD)("div",h,[(0,l._)("form",{onSubmit:a[2]||(a[2]=(0,o.iM)((e=>(0,c.SU)(s).auth("/login",M)),["prevent"]))},[p,(0,l._)("div",g,[v,(0,l.wy)((0,l._)("input",(0,l.dG)({"onUpdate:modelValue":a[0]||(a[0]=e=>(0,c.dq)(r)?r.value=e:null)},(0,c.SU)(D),{type:"text",class:"form-control",id:"inputUsername"}),null,16),[[o.nr,(0,c.SU)(r)]]),f,(0,l.Uk)(" "+(0,u.zw)((0,c.SU)(n).username),1)]),(0,l._)("div",j,[w,(0,l.wy)((0,l._)("input",(0,l.dG)({type:"password"},(0,c.SU)(C),{"onUpdate:modelValue":a[1]||(a[1]=e=>M.password=e),class:"form-control",id:"inputPassword"}),null,16),[[o.nr,M.password]]),(0,l.Uk)(" "+(0,u.zw)((0,c.SU)(n).password),1)]),_,(0,l._)("div",b,[(0,l._)("span",k,(0,u.zw)((0,c.SU)(s).error),1)]),(0,l._)("div",y,[(0,l._)("span",S,(0,u.zw)((0,c.SU)(s).user),1)]),(0,l._)("div",U,[(0,l.Wm)(i,{to:{name:"register"},class:"btn btn-primary"},{default:(0,l.w5)((()=>[(0,l.Uk)("Создать аккаунт")])),_:1})]),(0,l._)("button",{disabled:!(0,c.SU)(t).valid,type:"submit",class:"btn btn-success"},"Войти ",8,x),(0,c.SU)(s).loader?((0,l.wg)(),(0,l.iD)("div",z,R)):(0,l.kq)("",!0)],32)])}}};const C=O;var M=C;const q={class:"container login-form",style:{"max-width":"50%"}},F=(0,l._)("h2",{style:{"padding-bottom":"8px","text-align":"center"}},"Регистрация",-1),L={class:"mb-3"},H=(0,l._)("label",{for:"inputUsername",class:"form-label"},"Имя пользователя",-1),P=(0,l._)("div",{id:"usernameHelp",class:"form-text"},"Введите имя пользователя",-1),T={class:"mb-3"},A=(0,l._)("label",{for:"inputPassword",class:"form-label"},"Пароль",-1),W={class:"mb-3"},E={class:"text-danger"},I={class:"mb-3"},Y={class:"text-success"},B={class:"mb-3 center"},N=["disabled"],G={key:0,class:"d-flex justify-content-center"},V=(0,l._)("div",{class:"spinner-border",role:"status"},[(0,l._)("span",{class:"visually-hidden"},"Loading...")],-1),K=[V];var Q={__name:"RegisterComponent",setup(e){const s=i(),{meta:t,errors:n,defineField:a}=(0,d.cI)({validationSchema:m.Ry({username:m.Z_().required(),password:m.Z_().required().min(6).max(12)})}),[r,h]=a("username"),[p,g]=a("password"),v=(0,c.qj)({username:r,password:p});return(e,a)=>{const i=(0,l.up)("router-link");return(0,l.wg)(),(0,l.iD)("div",q,[(0,l._)("form",{onSubmit:a[2]||(a[2]=(0,o.iM)((e=>(0,c.SU)(s).auth("/register",v)),["prevent"]))},[F,(0,l._)("div",L,[H,(0,l.wy)((0,l._)("input",(0,l.dG)({"onUpdate:modelValue":a[0]||(a[0]=e=>(0,c.dq)(r)?r.value=e:null)},(0,c.SU)(h),{type:"text",class:"form-control",id:"inputUsername"}),null,16),[[o.nr,(0,c.SU)(r)]]),P,(0,l.Uk)(" "+(0,u.zw)((0,c.SU)(n).username),1)]),(0,l._)("div",T,[A,(0,l.wy)((0,l._)("input",(0,l.dG)({type:"password"},(0,c.SU)(g),{"onUpdate:modelValue":a[1]||(a[1]=e=>v.password=e),class:"form-control",id:"inputPassword"}),null,16),[[o.nr,v.password]]),(0,l.Uk)(" "+(0,u.zw)((0,c.SU)(n).password),1)]),(0,l._)("div",W,[(0,l._)("span",E,(0,u.zw)((0,c.SU)(s).error),1)]),(0,l._)("div",I,[(0,l._)("span",Y,(0,u.zw)((0,c.SU)(s).user),1)]),(0,l._)("div",B,[(0,l.Wm)(i,{to:{name:"login"},class:"btn btn-primary"},{default:(0,l.w5)((()=>[(0,l.Uk)("Войти в аккаунт")])),_:1})]),(0,l._)("button",{disabled:!(0,c.SU)(t).valid,type:"submit",class:"btn btn-success"},"Создать аккаунт ",8,N),(0,c.SU)(s).loader?((0,l.wg)(),(0,l.iD)("div",G,K)):(0,l.kq)("",!0)],32)])}}};const Z=Q;var $=Z,J={__name:"AuthLayout",setup(e){const s=i();return s.getUser(),(e,s)=>{const t=(0,l.up)("router-view");return(0,l.wg)(),(0,l.j4)(t)}}};const X=J;var ee=X,se=t(4488);const te=e=>(0,se.io)("",{autoConnect:!0,query:{token:e}}),oe=(0,n.Q_)("connection",{state:()=>({authStore:i(),isConnected:!1,socket:null}),actions:{bindEvents(){this.socket.on("connect",(()=>{this.isConnected=!0})),this.socket.on("disconnect",(()=>{this.isConnected=!1}))},connect(){this.socket=te(this.authStore.token),this.socket.connect()}}}),ne="",ae=(0,n.Q_)("roomStore",{state:()=>({auth:i(),roomList:[],currentRoom:localStorage.getItem("currentRoom")?JSON.parse(localStorage.getItem("currentRoom")):{},messages:[],error:"",loader:!1,loaderRoom:!1,isEmpty:!0,socketStore:oe(),offset:0,count:20}),actions:{subscribeOnLocal(){this.$subscribe(((e,s)=>{localStorage.setItem("currentRoom",JSON.stringify(this.currentRoom))}))},async joinRoom(){this.socketStore.socket.emit("join",this.currentRoom)},async getRooms(){await this.auth.getUser(),this.loaderRoom=!0;const e=await fetch(ne+"/rooms",{mode:"cors",credentials:"same-origin"});this.loaderRoom=!1,e.ok||(this.error=await e.json().error),this.roomList=await e.json()},async getMessages(){if(this.loader=!0,!this.currentRoom)return;const e=await fetch(ne+"/room/"+this.currentRoom.id+"?count="+this.count+"&offset="+this.offset,{mode:"cors",credentials:"same-origin"});if(!e.ok)return void(this.error=await e.json().error);const s=await e.json(),t=s.messages;0===this.offset&&(this.messages=[]),this.isEmpty=0==t.length;for(const o in t)this.messages.unshift(t[o]);return this.loader=!1,this.messages},updateLastMessage(e){for(const s of this.roomList)s.id===e.room_id&&(s.last_message=e)}},getters:{isAuth(){return""!==this.user}}});var re=t(6797),ie=t.n(re);const le={class:"row"},ce={class:"room-name col-auto"},ue={class:"col-auto room-last-message-date"},de={class:"row"},me={class:"col-6",style:{"word-break":"break-all"}},he={key:0,class:"room-last-message"},pe={key:1,class:"room-last-message"},ge=(0,l._)("div",{class:"col-4"},[(0,l._)("span",{class:"room-missed-message",style:{height:"20px",width:"20px"}},"8")],-1);var ve={__name:"RoomComponent",props:{room:{type:Object,required:!0,default:()=>{}}},setup(e){const s=ae(),t=e=>{if(e)return ie()(String(e)).format("hh:mm DD.MM")},o=e=>e&&e.length>30?e.slice(0,30)+"...":e;return(n,a)=>((0,l.wg)(),(0,l.iD)("div",{class:(0,u.C_)(["room",{active:e.room.id===(0,c.SU)(s).currentRoom.id}]),onClick:a[0]||(a[0]=s=>n.$emit("onRoomClick",e.room))},[(0,l._)("div",le,[(0,l._)("span",ce,(0,u.zw)(e.room.name),1),(0,l._)("span",ue,(0,u.zw)(t(e.room.last_message.date)),1)]),(0,l._)("div",de,[(0,l._)("div",me,[e.room.last_message.text?((0,l.wg)(),(0,l.iD)("span",he,(0,u.zw)(o(e.room.last_message.text)),1)):((0,l.wg)(),(0,l.iD)("span",pe,"Нет сообщений"))]),ge])],2))}};const fe=ve;var je=fe;const we={class:"container m-0"},_e={key:0,class:"rooms"},be={key:1,class:"rooms d-flex justify-content-center"},ke=(0,l._)("div",{class:"spinner-border",role:"status"},[(0,l._)("span",{class:"visually-hidden"},"Loading...")],-1);var ye={__name:"RoomsList",setup(e){const s=ae();return s.getRooms(),s.joinRoom(),s.subscribeOnLocal(),s.getMessages(),(0,l.YP)((()=>s.currentRoom),((e,t)=>{s.joinRoom(),s.offset=0,s.getMessages(),Gs.push({name:"room",params:{id:s.currentRoom.id}})}),{deep:"true"}),(e,t)=>((0,l.wg)(),(0,l.iD)("div",we,[(0,c.SU)(s).loaderRoom?((0,l.wg)(),(0,l.iD)("div",be,[(0,l.Uk)(" Комнаты загружаются "),ke])):((0,l.wg)(),(0,l.iD)("div",_e,[((0,l.wg)(!0),(0,l.iD)(l.HY,null,(0,l.Ko)((0,c.SU)(s).roomList,(e=>((0,l.wg)(),(0,l.j4)(je,{onOnRoomClick:t=>(0,c.SU)(s).currentRoom=e,key:e.id,room:e},null,8,["onOnRoomClick","room"])))),128))]))]))}};const Se=ye;var Ue=Se;const xe="",ze=(0,n.Q_)("attachmentsStore",{state:()=>({attachedFiles:[],errors:{},room:ae(),authStore:i()}),actions:{async uploadFile(e){let s=new FormData;s.append("room_id",this.room.currentRoom.id),s.append("file",e),console.log(s);const t=await fetch(xe+"/upload",{method:"POST",headers:{Authorization:"Bearer "+this.authStore.token},mode:"cors",credentials:"same-origin",body:s});if(!t.ok)return void alert("Неудалось загрузить");const o=await t.json();for(const n of o)this.attachedFiles.push(n)},clearAttachments(){this.attachedFiles=[]},removeAttachment(e){const s=this.attachedFiles.indexOf(e);-1!==s&&this.attachedFiles.splice(s,1)}},getters:{countAttachedFiles(){return this.attachedFiles.length}}}),De="",Re=(0,n.Q_)("messageStore",{state:()=>({authStore:i(),room:ae(),socketStore:oe(),selectedMessages:[],attachedStore:ze()}),actions:{sendMessage(e){e.room_id=this.room.currentRoom.id,this.socketStore.socket.emit("new_message",e),this.room.updateLastMessage(e)},async removeMessages(e){const s=[...e];for(let t of s){const s=await fetch(De+"/message/"+t.id,{method:"DELETE",headers:{Authorization:"Bearer "+this.authStore.token},credentials:"same-origin"});console.log(s.ok);const o=this.room.messages.indexOf(t),n=e.indexOf(t);-1!==o&&(this.room.messages.splice(o,1),e.splice(n,1))}},async search(e){const s=await fetch(De+"/messages/search?query="+e+"&room_id="+this.room.currentRoom.id,{method:"GET",headers:{Authorization:"Bearer "+this.authStore.token},credentials:"same-origin"});s.ok&&(this.room.messages=await s.json())},subscribe(){this.socketStore.socket.on("join",(e=>{console.log(e)})),this.socketStore.socket.on("chat",(e=>{console.log(e),this.room.messages.push(e)})),this.socketStore.socket.on("delete",(e=>{this.removeMessage(e)}))}}}),Oe={key:0,class:"clearfix"},Ce={class:"message m-1"},Me={class:"row"},qe={class:"col"},Fe={class:"row"},Le={class:"col"},He={class:"message-owner m-1"},Pe={class:"row"},Te={class:"col"},Ae={class:"row"},We={class:"container d-flex justify-content-between"},Ee=["src"],Ie={class:"row"},Ye={class:"col"};var Be={__name:"MessageComponent",props:{message:{type:Object,required:!0,default:()=>{}},isSender:{type:Boolean,required:!1,default:!1}},setup(e){Re();const s="",t=e=>{if(e)return ie()(String(e)).format("hh:mm")};let o=(0,c.iH)(!1);return(n,a)=>e.isSender?((0,l.wg)(),(0,l.iD)("div",{key:1,class:(0,u.C_)(["clearfix",{selected:(0,c.SU)(o)}]),onClick:a[0]||(a[0]=e=>(0,c.dq)(o)?o.value=!(0,c.SU)(o):o=!(0,c.SU)(o))},[(0,l._)("div",He,[(0,l._)("div",Pe,[(0,l._)("div",Te,[(0,l._)("span",null,(0,u.zw)(e.message.user.username)+" "+(0,u.zw)(t(e.message.date)),1)])]),(0,l._)("div",Ae,[(0,l._)("div",We,[((0,l.wg)(!0),(0,l.iD)(l.HY,null,(0,l.Ko)(e.message.attachments,(e=>((0,l.wg)(),(0,l.iD)("div",{class:"attachment-wrapper",key:e.id},[(0,l._)("img",{class:"attachments",src:(0,c.SU)(s)+e.link,width:"200",height:"340",alt:"attach.type"},null,8,Ee)])))),128))])]),(0,l._)("div",Ie,[(0,l._)("div",Ye,[(0,l._)("span",null,(0,u.zw)(e.message.text),1)])])])],2)):((0,l.wg)(),(0,l.iD)("div",Oe,[(0,l._)("div",Ce,[(0,l._)("div",Me,[(0,l._)("div",qe,[(0,l._)("span",null,(0,u.zw)(e.message.user.username)+" "+(0,u.zw)(t(e.message.date)),1)])]),(0,l._)("div",Fe,[(0,l._)("div",Le,[(0,l._)("span",null,(0,u.zw)(e.message.text),1)])])])]))}};const Ne=Be;var Ge=Ne,Ve=t.p+"img/send.0339349f.svg",Ke=t.p+"img/paperclip.834a86e0.svg";const Qe=(0,l._)("img",{class:"attach-img",src:Ke},null,-1),Ze=[Qe];var $e={__name:"AttachComponent",setup(e){const s=(0,c.iH)(null),t=ze(),n=e=>{for(const s of e.target.files)t.uploadFile(s)};return(e,t)=>((0,l.wg)(),(0,l.iD)(l.HY,null,[(0,l._)("button",{class:"btn attach",onClick:t[0]||(t[0]=e=>s.value.click())},Ze),(0,l.wy)((0,l._)("input",{multiple:"",ref_key:"inputFile",ref:s,onChange:n,type:"file"},null,544),[[o.F8,!1]])],64))}};const Je=$e;var Xe=Je;const es={class:"input"},ss=(0,l._)("img",{class:"send-img",src:Ve},null,-1),ts=[ss];var os={__name:"InputMessage",emits:["onMessageSend"],setup(e,{emit:s}){const t=(0,c.iH)(""),n=Re(),a=ze(),r=s;n.subscribe();const i=()=>{n.sendMessage({text:t.value,date:new Date,attachments:a.attachedFiles}),a.clearAttachments(),t.value="",r("onMessageSend")};return(e,s)=>((0,l.wg)(),(0,l.iD)("div",es,[(0,l.Wm)(Xe),(0,l.wy)((0,l._)("input",{onKeydown:(0,o.D2)(i,["enter"]),ref:"inputText","onUpdate:modelValue":s[0]||(s[0]=e=>t.value=e),minlength:"1",required:"",id:"message",type:"text",class:"form-control",placeholder:"Введите сообщение...","aria-label":"Default","aria-describedby":"inputGroup-sizing-default"},null,544),[[o.nr,t.value]]),(0,l._)("button",{onClick:i,class:"btn send-msg",id:"send_msg"},ts)]))}};const ns=os;var as=ns;const rs={key:0,class:"container-fluid",style:{position:"absolute",height:"90%"}},is=["src","alt"];Boolean;const ls={class:"container d-flex attach-container flex-column"},cs=["src","alt"];var us={__name:"AttachedImage",props:{attachment:{type:Object,required:!0,default:()=>{}},index:Number},setup(e){const s=ze(),t="",o=(0,c.iH)(!1),n=(0,c.iH)(!1);return(a,r)=>((0,l.wg)(),(0,l.iD)("div",ls,[(0,l._)("img",{class:(0,u.C_)(["attached-img mb-1",{"remove-attach":o.value}]),src:(0,c.SU)(t)+e.attachment.link,width:"150px",height:"170px",alt:`Фотография ${e.index+1}`,onClick:r[0]||(r[0]=e=>n.value=!0)},null,10,cs),(0,l._)("button",{class:"btn p-0",onClick:r[1]||(r[1]=t=>(0,c.SU)(s).removeAttachment(e.attachment))},"Удалить")]))}};const ds=us;var ms=ds;const hs={class:"attached-files-list d-flex flex-wrap"};var ps={__name:"AttachedFiles",setup(e){const s=ze();return(e,t)=>((0,l.wg)(),(0,l.iD)("div",hs,[((0,l.wg)(!0),(0,l.iD)(l.HY,null,(0,l.Ko)((0,c.SU)(s).attachedFiles,((e,s)=>((0,l.wg)(),(0,l.iD)("div",{key:s,class:"attached-file"},[(0,l.Wm)(ms,{attachment:e,index:s},null,8,["attachment","index"])])))),128))]))}};const gs=ps;var vs=gs;const fs={class:"container control-container p-0"};var js={__name:"ControlPanel",setup(e){return(e,s)=>((0,l.wg)(),(0,l.iD)("div",fs,[(0,l.Wm)(as,{onOnMessageSend:s[0]||(s[0]=s=>{e.$emit("onMessageSend"),console.log("scroll control")})}),(0,l.Wm)(vs)]))}};const ws=js;var _s=ws;const bs={key:0};var ks={__name:"UploadFile",setup(e){const s=ze(),t=(0,c.iH)(null),o=(0,c.iH)(!1),n=e=>{for(let t=0;t<e.target.files.length;t++)s.uploadFile(e.target.files[t]);t.value&&(t.value.value=""),o.value=!1};return(e,s)=>((0,l.wg)(),(0,l.iD)("div",{class:(0,u.C_)(["input-wrapper",{dragged:o.value}])},[o.value?((0,l.wg)(),(0,l.iD)("span",bs,"Перетащите сюда файл")):(0,l.kq)("",!0),(0,l._)("input",{ref:t.value,onChange:n,class:"draggedFile",title:"",type:"file",multiple:"",onDragenter:s[0]||(s[0]=e=>o.value=!0),onDragleave:s[1]||(s[1]=e=>o.value=!1)},null,544)],2))}};const ys=ks;var Ss=ys;const Us={class:"input-group mb-3"},xs=(0,l._)("button",{type:"button",class:"btn btn-secondary",id:"search-run"},"Искать",-1);var zs={__name:"MessageMenu",props:{showRemove:{type:Boolean},messages:{type:Object}},setup(e){const s=Re();return(t,o)=>((0,l.wg)(),(0,l.iD)("div",Us,[(0,l._)("input",{id:"search-form",onInput:o[0]||(o[0]=e=>(0,c.SU)(s).search(e.target.value)),type:"text",class:"form-control",minlength:"1",placeholder:"Введите запрос...","aria-label":"Поиск","aria-describedby":"basic-addon1"},null,32),xs,e.showRemove?((0,l.wg)(),(0,l.iD)("button",{key:0,type:"button",onClick:o[1]||(o[1]=t=>(0,c.SU)(s).removeMessages(e.messages)),class:"btn btn-danger"},"Удалить сообщение")):(0,l.kq)("",!0)]))}};const Ds=zs;var Rs=Ds;const Os={class:"col-8 chat-window",style:{padding:"0"}},Cs={key:0,class:"text-center"},Ms={class:"messages"},qs={key:1,class:"d-flex justify-content-center"},Fs=(0,l._)("div",{class:"spinner-border",role:"status"},[(0,l._)("span",{class:"visually-hidden"},"Loading...")],-1),Ls=[Fs],Hs={class:"control"};var Ps={__name:"MessagesList",props:{id:{type:Number,required:!0}},emits:["getMessages"],setup(e,{emit:s}){const t=ae(),o=i(),n=oe(),a=(0,c.iH)(!1),r=(0,c.qj)({selected:[]}),u=(0,c.iH)(null);(0,l.YP)(r.selected,((e,s)=>{a.value=e.length>0}));const d=e=>{const s=r.selected.indexOf(e);-1===s?e.user.id===o.user.id&&r.selected.push(e):r.selected.splice(s,1)};n.socket.on("chat",(e=>{m()})),(0,l.YP)((()=>t.messages),((e,s)=>{}),{flush:"post"}),(0,l.YP)((()=>t.messages),((e,s)=>{m()}),{flush:"post"});const m=()=>{u.value&&null!==u.value.scrollTop&&null!==u.value.scrollHeight&&(u.value.scrollTop=u.value.scrollHeight)},h=()=>{u.value.scrollTop<=0&&t.messages&&(t.offset+=t.count,t.getMessages())};return(e,s)=>((0,l.wg)(),(0,l.iD)("div",Os,[(0,l.Wm)(Rs,{showRemove:a.value,messages:r.selected},null,8,["showRemove","messages"]),(0,l.Wm)(Ss),(0,l._)("div",{class:"container chat-message",onScroll:h,ref_key:"messageList",ref:u},[0==(0,c.SU)(t).messages.length?((0,l.wg)(),(0,l.iD)("p",Cs,"В комнате нет сообщений")):(0,l.kq)("",!0),(0,l._)("div",Ms,[((0,l.wg)(!0),(0,l.iD)(l.HY,null,(0,l.Ko)((0,c.SU)(t).messages,(e=>((0,l.wg)(),(0,l.j4)(Ge,{onClick:s=>d(e),key:e.id,message:e,isSender:e.user.id===(0,c.SU)(o).user.id},null,8,["onClick","message","isSender"])))),128))]),(0,c.SU)(t).loader?((0,l.wg)(),(0,l.iD)("div",qs,Ls)):(0,l.kq)("",!0),(0,l._)("div",Hs,[(0,l.Wm)(_s,{onOnMessageSend:m})])],544)]))}};const Ts=Ps;var As=Ts;const Ws={class:"container-fluid window"},Es={class:"row m-1"},Is={class:"col-4 room-window",style:{padding:"0"}};var Ys={__name:"ChatView",setup(e){const s=i(),t=(ae(),oe());return s.getUser(),t.connect(),t.bindEvents(),(e,s)=>{const t=(0,l.up)("router-view");return(0,l.wg)(),(0,l.iD)("div",Ws,[(0,l._)("div",Es,[(0,l._)("div",Is,[(0,l.Wm)(Ue)]),(0,l.Wm)(t)])])}}};const Bs=Ys;var Ns=Bs;const Gs=(0,a.p7)({history:(0,a.PO)(),routes:[{path:"/",redirect:{name:"login"},component:ee,children:[{name:"login",path:"/login",component:M},{name:"register",path:"/register",component:$}]},{path:"/chat",component:Ns,children:[{name:"room",path:":id",component:As}]},{path:"/:pathMatch(.*)",component:Ue}]});function Vs(e,s){const t=(0,l.up)("router-view");return(0,l.wg)(),(0,l.j4)(t)}var Ks=t(89);const Qs={},Zs=(0,Ks.Z)(Qs,[["render",Vs]]);var $s=Zs;t(2166);(0,o.ri)($s).use(Gs).use((0,n.WB)()).mount("#app")}},s={};function t(o){var n=s[o];if(void 0!==n)return n.exports;var a=s[o]={id:o,loaded:!1,exports:{}};return e[o].call(a.exports,a,a.exports,t),a.loaded=!0,a.exports}t.m=e,function(){var e=[];t.O=function(s,o,n,a){if(!o){var r=1/0;for(u=0;u<e.length;u++){o=e[u][0],n=e[u][1],a=e[u][2];for(var i=!0,l=0;l<o.length;l++)(!1&a||r>=a)&&Object.keys(t.O).every((function(e){return t.O[e](o[l])}))?o.splice(l--,1):(i=!1,a<r&&(r=a));if(i){e.splice(u--,1);var c=n();void 0!==c&&(s=c)}}return s}a=a||0;for(var u=e.length;u>0&&e[u-1][2]>a;u--)e[u]=e[u-1];e[u]=[o,n,a]}}(),function(){t.n=function(e){var s=e&&e.__esModule?function(){return e["default"]}:function(){return e};return t.d(s,{a:s}),s}}(),function(){t.d=function(e,s){for(var o in s)t.o(s,o)&&!t.o(e,o)&&Object.defineProperty(e,o,{enumerable:!0,get:s[o]})}}(),function(){t.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"===typeof window)return window}}()}(),function(){t.o=function(e,s){return Object.prototype.hasOwnProperty.call(e,s)}}(),function(){t.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}}(),function(){t.nmd=function(e){return e.paths=[],e.children||(e.children=[]),e}}(),function(){t.p="/"}(),function(){var e={143:0};t.O.j=function(s){return 0===e[s]};var s=function(s,o){var n,a,r=o[0],i=o[1],l=o[2],c=0;if(r.some((function(s){return 0!==e[s]}))){for(n in i)t.o(i,n)&&(t.m[n]=i[n]);if(l)var u=l(t)}for(s&&s(o);c<r.length;c++)a=r[c],t.o(e,a)&&e[a]&&e[a][0](),e[a]=0;return t.O(u)},o=self["webpackChunkchat"]=self["webpackChunkchat"]||[];o.forEach(s.bind(null,0)),o.push=s.bind(null,o.push.bind(o))}();var o=t.O(void 0,[998],(function(){return t(7069)}));o=t.O(o)})();
//# sourceMappingURL=app.db5c821c.js.map